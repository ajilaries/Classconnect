<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Poll - ClassConnect</title>
  <link rel="stylesheet" href="admin_poll.css">
</head>
<body>
  <div class="poll-container">
    <h2>ðŸ“‹ Create New Poll</h2>

    <form id="create-poll-form" method="POST" action="create_poll.php">
      <label for="question">Poll Question:</label>
      <input type="text" id="question" name="question" placeholder="Type your Question?" required>

      <label>Options:</label>
      <div id="options-container">
        <input type="text" name="options[]" placeholder="Option 1" required>
        <input type="text" name="options[]" placeholder="Option 2" required>
      </div>
      <button type="button" id="add-option-btn">âž• Add Option</button>

      <label for="expires_in">Expires In (minutes):</label>
      <input type="number" name="expires_in" id="expires_in" placeholder="e.g. 10">

      <label>
        <input type="checkbox" name="is_anonymous"> Anonymous Voting
      </label>

      <label>
        <input type="checkbox" name="is_multiple_choice"> Allow Multiple Choice
      </label>

      <button type="submit" class="submit-btn">âœ… Create Poll</button>
    </form>

    <hr>

    <form action="end_poll.php" method="POST">
      <button type="submit" class="end-btn">ðŸ›‘ End Current Poll</button>
    </form>
  </div>

  <script>
    // Dynamically add options
    document.getElementById("add-option-btn").addEventListener("click", () => {
      const container = document.getElementById("options-container");
      const input = document.createElement("input");
      input.type = "text";
      input.name = "options[]";
      input.placeholder = "New Option";
      input.required = true;
      container.appendChild(input);
    });

  document.getElementById("create-poll-form").addEventListener("submit", function (e) {
    const questionInput = document.getElementById("question");
    const options = document.querySelectorAll('input[name="options[]"]');
    const question = questionInput.value.trim();

    // Validation 1: Starts with uppercase
    if (!/^[A-Z]/.test(question)) {
      alert("Poll question must start with an uppercase letter.");
      questionInput.focus();
      e.preventDefault();
      return;
    }

    // Validation 2: Ends with ?
    if (!/\?$/.test(question)) {
      alert("Poll question must end with a question mark (?).");
      questionInput.focus();
      e.preventDefault();
      return;
    }

    // Validation 3: At least 2 valid options
    let validOptions = 0;
    for (let opt of options) {
      if (opt.value.trim().length >= 3) {
        validOptions++;
      } else {
        alert("Each option must be at least 3 characters long.");
        opt.focus();
        e.preventDefault();
        return;
      }
    }

    if (validOptions < 2) {
      alert("Please provide at least two valid options (3+ characters each).");
      e.preventDefault();
      return;
    }
  });

  </script>
</body>
</html>
